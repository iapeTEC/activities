<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Leil√£o de Jogadores ‚Äî T√©cnico Bruno</title>
  <style>
    :root{
      --bg:#f7f9fb;      /* tema claro */
      --card:#ffffff;
      --ink:#0f172a;      /* azul-ard√≥sia escuro para texto */
      --muted:#64748b;    /* cinza-azulado */
      --green:#10b981;    /* verde */
      --green-ink:#065f46;
      --blue:#2563eb;     /* azul */
      --blue-ink:#1e3a8a;
      --danger:#ef4444;   /* vermelho para avisos */
      --ring:#93c5fd;     /* foco */
      --radius:16px;
      --shadow:0 6px 20px rgba(2,6,23,.08);
      --maxw:880px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui,-apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--ink); background:var(--bg);
      display:flex; flex-direction:column; align-items:center;
    }
    .sr-only{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    header{
      width:100%; background:linear-gradient(180deg,#eaf2ff,#ffffff);
      border-bottom:1px solid #e5e9f2;
    }
    .wrap{ width:100%; max-width:var(--maxw); margin:0 auto; padding:16px; }
    .brand{ display:flex; align-items:center; gap:12px; }
    .brand .logo{ font-size:28px; }
    .brand h1{ font-size:20px; margin:0; }
    .subtitle{ color:var(--muted); font-size:13px; margin-top:2px; }

    main{ width:100%; max-width:var(--maxw); padding:16px; display:grid; gap:16px; }

    .card{ background:var(--card); border:1px solid #eef2f7; border-radius:var(--radius); box-shadow:var(--shadow); padding:16px; }

    .grid{ display:grid; gap:12px; }

    /* Indicadores */
    .stats{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .stat{ background:#f8fafc; border:1px solid #edf2f7; border-radius:12px; padding:12px; }
    .stat h3{ margin:0 0 6px 0; font-size:13px; color:var(--muted); font-weight:600; }
    .money{ font-variant-numeric: tabular-nums; font-size:22px; font-weight:700; }
    .money.green{ color:var(--green-ink); }
    .money.blue{ color:var(--blue-ink); }

    /* Barra de progresso do or√ßamento */
    .progress{ height:14px; background:#e5edf9; border-radius:999px; overflow:hidden; border:1px solid #dbe7fb; }
    .progress > span{ display:block; height:100%; background:linear-gradient(90deg,#34d399,#10b981); width:100%; }

    /* Controles principais */
    .controls{ display:grid; grid-template-columns: 1fr auto; gap:12px; align-items:center; }
    .cta{ user-select:none; -webkit-tap-highlight-color: transparent; }
    .btn{
      display:inline-flex; justify-content:center; align-items:center; gap:10px;
      padding:16px; border-radius:18px; border:0; cursor:pointer; font-weight:800; letter-spacing:.3px; font-size:18px;
      transition: transform .04s ease, box-shadow .2s ease;
      box-shadow: 0 8px 22px rgba(16,185,129,.25);
    }
    .btn:active{ transform: translateY(1px) scale(.995); }
    .btn.raise{ background:linear-gradient(180deg,#34d399,#10b981); color:#053825; }
    .btn.raise .big{ font-size:26px; }

    .btn-mini{ padding:12px 14px; font-weight:700; font-size:14px; border-radius:12px; border:0; cursor:pointer; }
    .btn-refund{ background:linear-gradient(180deg,#93c5fd,#60a5fa); color:#0b2a6b; box-shadow:0 6px 18px rgba(37,99,235,.25); }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .row .btn-ghost{ background:#fff; border:1px solid #e5eaf3; color:#0f172a; }
    .row .btn-danger{ background: #fee2e2; color:#991b1b; border:1px solid #fecaca; }
    .row .btn-blue{ background:#1d4ed8; color:#fff; }
    .row .btn-outline{ background:#fff; color:#1d4ed8; border:1px solid #bfdbfe; }

    /* Plano de elenco */
    .plan{ display:grid; gap:14px; }
    .plan h3{ margin:0; font-size:16px; }
    .slot-group{ display:grid; gap:10px; }
    .slot{ display:grid; gap:8px; border:1px solid #e8eef8; border-radius:12px; background:#fafcff; padding:12px; }
    .slot-head{ display:flex; justify-content:space-between; align-items:center; gap:8px; }
    .slot-title{ font-weight:800; }
    .slot-meta{ font-size:13px; color:var(--muted); }
    .slot .progress{ height:10px; }
    .slot .progress > span{ background:linear-gradient(90deg,#93c5fd,#2563eb); }
    .slot-overspend{ color:var(--danger); font-weight:700; font-size:12px; }

    /* Lista de jogadores */
    .roster{ display:grid; gap:10px; }
    .player{ display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center; padding:12px; border:1px solid #e8eef8; border-radius:12px; background:#fafcff; }
    .player .name{ font-weight:700; }
    .player .price{ font-variant-numeric: tabular-nums; color:var(--blue-ink); font-weight:800; }

    .muted{ color:var(--muted); font-size:13px; }

    footer{ margin-top:auto; width:100%; border-top:1px solid #e9eff8; background:#f8fbff; }
    footer .wrap{ display:flex; justify-content:space-between; align-items:center; gap:8px; }
    footer small{ color:var(--muted); }

    /* Modal (nome + vaga) */
    .modal-backdrop{ position:fixed; inset:0; background:rgba(2,6,23,.35); display:none; place-items:center; padding:16px; }
    .modal{ width:100%; max-width:520px; background:#fff; border-radius:18px; box-shadow:0 18px 50px rgba(2,6,23,.25); padding:18px; border:1px solid #e7ecf6; }
    .modal h2{ margin:0 0 8px 0; }
    .modal .field{ display:grid; gap:6px; margin:10px 0 16px; }
    .modal input, .modal select{ padding:12px 14px; border-radius:12px; border:1px solid #dce5f3; font-size:16px; }

    /* Responsividade */
    @media (min-width:720px){
      .controls{ grid-template-columns: 1fr auto auto; }
      .stats{ grid-template-columns: 1fr 1fr 1fr; }
      .plan{ grid-template-columns: 1fr 1fr; }
    }

    /* Estilo de impress√£o: elenco e plano */
    @media print{
      header, .actions, .auction, .progress, footer, .muted { display:none !important; }
      body{ background:#fff; }
      .card{ box-shadow:none; border:0; }
      .print-title{ display:block !important; font-size:22px; font-weight:800; margin-bottom:12px; }
      .player{ border:1px solid #000; }
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap brand">
      <div class="logo" aria-hidden="true">üí∏</div>
      <div>
        <h1>Leil√£o de Jogadores</h1>
        <div class="subtitle">T√©cnico Bruno ‚Ä¢ Or√ßamento inicial: <strong>R$ 1.000.000</strong></div>
      </div>
    </div>
  </header>

  <main>
    <section class="card grid auction" aria-labelledby="sec-ctl">
      <h2 id="sec-ctl" class="sr-only">Controles do Leil√£o</h2>

      <div class="stats">
        <div class="stat">
          <h3>üí∞ Saldo restante</h3>
          <div id="saldo" class="money green">R$ 1.000.000</div>
        </div>
        <div class="stat">
          <h3>üñêÔ∏è Lance atual (este jogador)</h3>
          <div id="lanceAtual" class="money blue">R$ 0</div>
        </div>
        <div class="stat">
          <h3>üì¶ Total comprometido</h3>
          <div id="comprometido" class="money">R$ 0</div>
        </div>
      </div>

      <div class="progress" aria-label="Progresso de or√ßamento">
        <span id="bar" style="width:100%"></span>
      </div>

      <div class="controls">
        <button class="btn raise cta" id="btnLance" aria-label="Levantar a m√£o ‚Äî adiciona R$ 10.000 ao lance e desconta do saldo">
          <span class="big">‚ûï R$ 10.000</span>
        </button>

        <button class="btn-mini btn-refund" id="btnDevolver" aria-label="Devolver todo o lance atual ao saldo">Devolver lance</button>

        <div class="row actions">
          <button class="btn-mini btn-blue" id="btnFinalizar">Finalizar compra</button>
          <button class="btn-mini btn-outline" id="btnImprimir">Imprimir PDF do elenco</button>
          <button class="btn-mini btn-ghost" id="btnReset">Resetar tudo</button>
        </div>
      </div>

      <p class="muted">Dica: cada toque no bot√£o verde equivale a levantar a m√£o no leil√£o (+R$ 10.000). Se desistir, use o bot√£o azul <em>Devolver lance</em>. Ao finalizar, informe o nome do jogador e selecione uma <strong>vaga do plano</strong>; o valor ser√° comprometido e descontar√° do or√ßamento daquela vaga. Se voc√™ exceder o or√ßamento de uma vaga, o excedente ser√° automaticamente <strong>descontado do pr√≥ximo jogador do mesmo setor</strong>.</p>
    </section>

    <section class="card plan" id="planCard">
      <h2 style="margin-top:0">Plano de elenco (7 vagas)</h2>
      <div class="slot-group" id="groupA">
        <h3>‚öΩ Atacantes (2)</h3>
        <div class="sector-summary" id="sumA"></div>
        <div id="slotsA"></div>
      </div>
      <div class="slot-group" id="groupM">
        <h3>üéØ Meio-campo (3)</h3>
        <div class="sector-summary" id="sumM"></div>
        <div id="slotsM"></div>
      </div>
      <div class="slot-group" id="groupZ">
        <h3>üõ°Ô∏è Zagueiros (2)</h3>
        <div class="sector-summary" id="sumZ"></div>
        <div id="slotsZ"></div>
      </div>
    </section>

    <section class="card">
      <div class="print-title" style="display:none">Elenco comprado ‚Äî T√©cnico Bruno</div>
      <h2 style="margin-top:0">Elenco comprado</h2>
      <div id="lista" class="roster" aria-live="polite">
        <div class="muted">Nenhum jogador comprado ainda.</div>
      </div>
    </section>
  </main>

  <footer>
    <div class="wrap">
      <small>T√©cnico: <strong>Bruno</strong></small>
      <small>criado por <strong>Tecnologias Agostinho</strong></small>
    </div>
  </footer>

  <!-- Modal para nome do jogador e sele√ß√£o de vaga -->
  <div class="modal-backdrop" id="modal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="tModal">
      <h2 id="tModal">Finalizar compra</h2>
      <p class="muted" id="infoValor">Valor do lance: R$ 0</p>
      <div class="field">
        <label for="nomeJog">Nome do jogador</label>
        <input id="nomeJog" type="text" placeholder="Ex.: Jo√£o da Silva" />
      </div>
      <div class="field">
        <label for="slotSelect">Escolha a vaga do plano</label>
        <select id="slotSelect"></select>
        <small class="muted">Dica: escolha uma vaga com or√ßamento dispon√≠vel.</small>
      </div>
      <div class="row">
        <button class="btn-mini btn-blue" id="okModal">Confirmar</button>
        <button class="btn-mini btn-ghost" id="cancelModal">Cancelar</button>
      </div>
    </div>
  </div>

  <script>
    // ===== Utilidades =====
    const fmt = (n)=> new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL', maximumFractionDigits:0}).format(n);
    const clamp = (n,min,max)=> Math.min(Math.max(n,min),max);

    // ===== Estado =====
    const STEP = 10000; // valor por levantamento de m√£o
    const INITIAL = 1_000_000;

    const state = {
      saldo: INITIAL,
      lanceAtual: 0,
      comprometido: 0,
      elenco: [], // {nome, preco, slotId}
      slots: []   // {id, pos:'A'|'M'|'Z', label, budget, remaining, name:''}
    };

    // Persist√™ncia (navegador atual)
    const KEY = 'auction.bruno.v3';
    function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }
    function load(){ const raw = localStorage.getItem(KEY); if(!raw) return; try{ const s=JSON.parse(raw); Object.assign(state,s); }catch(e){} }

    // Defaults dos slots (somam 1.000.000):
    function ensureDefaultSlots(){
      if(state.slots && state.slots.length) return;
      const defaults = [
        {pos:'A', label:'Atacante 1', budget:160000},
        {pos:'A', label:'Atacante 2', budget:160000},
        {pos:'M', label:'Meio-campo 1', budget:140000},
        {pos:'M', label:'Meio-campo 2', budget:140000},
        {pos:'M', label:'Meio-campo 3', budget:140000},
        {pos:'Z', label:'Zagueiro 1',  budget:130000},
        {pos:'Z', label:'Zagueiro 2',  budget:130000},
      ].map((s,i)=> ({...s, id:'S'+(i+1), remaining:s.budget, name:''}));
      state.slots = defaults;
    }

    // ===== UI refs =====
    const elSaldo = document.getElementById('saldo');
    const elLance = document.getElementById('lanceAtual');
    const elComp  = document.getElementById('comprometido');
    const elBar   = document.getElementById('bar');
    const elLista = document.getElementById('lista');

    const slotsA = document.getElementById('slotsA');
    const slotsM = document.getElementById('slotsM');
    const slotsZ = document.getElementById('slotsZ');
    const sumA = document.getElementById('sumA');
    const sumM = document.getElementById('sumM');
    const sumZ = document.getElementById('sumZ');

    const btnLance = document.getElementById('btnLance');
    const btnDevolver = document.getElementById('btnDevolver');
    const btnFinalizar = document.getElementById('btnFinalizar');
    const btnImprimir = document.getElementById('btnImprimir');
    const btnReset = document.getElementById('btnReset');

    // Modal
    const modal = document.getElementById('modal');
    const infoValor = document.getElementById('infoValor');
    const nomeJog = document.getElementById('nomeJog');
    const slotSelect = document.getElementById('slotSelect');
    const okModal = document.getElementById('okModal');
    const cancelModal = document.getElementById('cancelModal');

    function openModal(){
      infoValor.textContent = `Valor do lance: ${fmt(state.lanceAtual)}`;
      modal.style.display='grid';
      nomeJog.value='';
      renderSlotOptions();
      nomeJog.focus();
    }
    function closeModal(){ modal.style.display='none'; }

    // ===== Helpers =====
    function getSlotById(id){ return state.slots.find(s=>s.id===id); }
    function getSlotIndex(id){ return state.slots.findIndex(s=>s.id===id); }

    function sectorTotals(pos){
      const slots = state.slots.filter(s=>s.pos===pos);
      const budget = slots.reduce((a,b)=> a + b.budget, 0);
      const spent = state.elenco.reduce((a,p)=>{
        const s = getSlotById(p.slotId); return s && s.pos===pos ? a + p.preco : a;
      }, 0);
      const remaining = budget - spent; // pode ficar negativo => setor estourado
      return {budget, spent, remaining};
    }

    // Drena excedente para pr√≥ximas vagas do mesmo setor (prefer√™ncia a partir da vaga atual)
    function drainOverspend(pos, fromIndex, amount){
      let remaining = amount;
      let drained = 0;
      // 1) varre vagas do mesmo setor ap√≥s a atual
      for(let i=fromIndex+1; i<state.slots.length && remaining>0; i++){
        const t = state.slots[i];
        if(t.pos!==pos || t.name) continue; // somente vagas do mesmo setor e ainda livres
        const take = Math.min(remaining, t.budget);
        if(take>0){
          t.budget -= take;
          t.remaining = Math.max(0, Math.min(t.remaining, t.budget));
          remaining -= take;
          drained += take;
        }
      }
      // 2) se ainda sobrar, varre do in√≠cio at√© a vaga atual
      for(let i=0; i<=fromIndex && remaining>0; i++){
        const t = state.slots[i];
        if(t.pos!==pos || t.name) continue;
        const take = Math.min(remaining, t.budget);
        if(take>0){
          t.budget -= take;
          t.remaining = Math.max(0, Math.min(t.remaining, t.budget));
          remaining -= take;
          drained += take;
        }
      }
      return drained; // total drenado de outras vagas
    }

    // ===== Render Helpers =====
    function renderSlotOptions(){
      const options = state.slots.map(s=>{
        const filled = !!s.name;
        const remain = s.remaining;
        const txt = `${s.label} ‚Äî ${s.pos==='A'?'Atacante':s.pos==='M'?'Meio-campo':'Zagueiro'} ‚Äî dispon√≠vel: ${fmt(Math.max(remain,0))}`;
        return `<option value="${s.id}" ${filled? 'disabled':''}>${txt}${filled?' (ocupado)':''}</option>`;
      }).join('');
      slotSelect.innerHTML = `<option value="" disabled selected>Selecione uma vaga</option>` + options;
    }

    function renderSectorSummary(pos, mount){
      const {budget, spent, remaining} = sectorTotals(pos);
      const pct = budget>0 ? clamp(Math.round(((budget - Math.max(remaining,0)) / budget) * 100), 0, 100) : 0;
      const title = pos==='A'? 'Atacantes' : pos==='M'? 'Meio-campo' : 'Zagueiros';
      mount.innerHTML = `
        <div class="slot-meta">Total do setor: <strong>${fmt(budget)}</strong> ‚Ä¢ Gasto: <strong>${fmt(spent)}</strong> ‚Ä¢ Dispon√≠vel: <strong>${fmt(remaining)}</strong></div>
        <div class="progress" aria-label="Total do setor ${title}"><span style="width:${pct}%"></span></div>
      `;
    }

    function renderSlots(){
      const byPos = {A:[], M:[], Z:[]};
      state.slots.forEach(s=> byPos[s.pos].push(s));
      function slotHTML(s){
        const pct = s.budget>0 ? clamp(Math.round((Math.max(s.remaining,0)/ s.budget)*100), 0, 100) : 0;
        const overs = s.remaining < 0 ? `<span class=\"slot-overspend\">excedido em ${fmt(-s.remaining)}</span>` : '';
        return `
          <div class="slot" data-id="${s.id}">
            <div class="slot-head">
              <div>
                <div class="slot-title">${s.label} ${s.name? '‚Ä¢ ' + s.name : '<span class="slot-meta">(aguardando nome)</span>'}</div>
                <div class="slot-meta">Dispon√≠vel: <strong>${fmt(Math.max(s.remaining,0))}</strong> de ${fmt(s.budget)} ${overs}</div>
              </div>
            </div>
            <div class="progress" aria-label="Or√ßamento da vaga ${s.label}"><span style="width:${pct}%"></span></div>
          </div>`
      }
      slotsA.innerHTML = byPos.A.map(slotHTML).join('');
      slotsM.innerHTML = byPos.M.map(slotHTML).join('');
      slotsZ.innerHTML = byPos.Z.map(slotHTML).join('');

      renderSectorSummary('A', sumA);
      renderSectorSummary('M', sumM);
      renderSectorSummary('Z', sumZ);
    }

    // ===== Render principal =====
    function render(){
      elSaldo.textContent = fmt(state.saldo);
      elLance.textContent = fmt(state.lanceAtual);
      elComp.textContent  = fmt(state.comprometido);

      const pct = clamp(Math.round((state.saldo/INITIAL)*100),0,100);
      elBar.style.width = pct + '%';

      // Bot√µes
      btnLance.disabled = state.saldo < STEP;
      btnDevolver.disabled = state.lanceAtual === 0;
      btnFinalizar.disabled = state.lanceAtual === 0;

      // Lista
      if(state.elenco.length === 0){
        elLista.innerHTML = '<div class="muted">Nenhum jogador comprado ainda.</div>';
      }else{
        elLista.innerHTML = state.elenco.map((p,i)=> `
          <div class="player" data-i="${i}">
            <div class="name">${i+1}. ${p.nome} <span class="muted">${p.slotId? '‚Ä¢ '+getSlotById(p.slotId)?.label:''}</span></div>
            <div class="price">${fmt(p.preco)}</div>
          </div>`).join('');
      }

      renderSlots();
      save();
    }

    // ===== A√ß√µes =====
    btnLance.addEventListener('click', ()=>{
      if(state.saldo >= STEP){
        state.saldo -= STEP;
        state.lanceAtual += STEP;
        render();
      }
    });

    btnDevolver.addEventListener('click', ()=>{
      if(state.lanceAtual>0){
        state.saldo += state.lanceAtual;
        state.lanceAtual = 0;
        render();
      }
    });

    btnFinalizar.addEventListener('click', ()=>{
      if(state.lanceAtual>0){
        // se todas vagas ocupadas, impede
        const available = state.slots.some(s=>!s.name);
        if(!available){
          alert('Todas as 7 vagas do plano j√° est√£o ocupadas. Voc√™ pode resetar para come√ßar de novo.');
          return;
        }
        openModal();
      }
    });

    okModal.addEventListener('click', ()=>{
      const nome = (nomeJog.value||'').trim();
      const slotId = slotSelect.value;
      if(!nome){ nomeJog.focus(); nomeJog.setAttribute('aria-invalid','true'); return; }
      if(!slotId){ slotSelect.focus(); return; }

      const slot = getSlotById(slotId);
      const idx = getSlotIndex(slotId);
      if(!slot || slot.name){ return; }

      const price = state.lanceAtual;

      // Compromete definitivamente: o valor j√° saiu do saldo, agora vai para comprometido e atualiza slot
      state.comprometido += price;

      // Calcula excedente em rela√ß√£o ao or√ßamento da VAGA
      const overspendCandidate = Math.max(0, price - slot.budget);
      // Drena do PR√ìXIMO( S ) do mesmo setor
      const drained = overspendCandidate > 0 ? drainOverspend(slot.pos, idx, overspendCandidate) : 0;

      // Atualiza vaga atual
      slot.name = nome;
      // remaining = budget - price + drenado (se n√£o cobrir tudo, ficar√° negativo ‚Äî vis√≠vel como excedente)
      slot.remaining = (slot.budget - price + drained);

      // Adiciona ao elenco
      state.elenco.push({nome, preco: price, slotId});

      // Zera lance e fecha
      state.lanceAtual = 0;
      closeModal();
      render();
    });

    cancelModal.addEventListener('click', ()=> closeModal());
    modal.addEventListener('click', (e)=>{ if(e.target===modal) closeModal(); });

    btnImprimir.addEventListener('click', ()=>{
      document.querySelector('.print-title').style.display='block';
      window.print();
      setTimeout(()=>{ document.querySelector('.print-title').style.display='none'; }, 500);
    });

    btnReset.addEventListener('click', ()=>{
      if(confirm('Tem certeza que deseja resetar tudo?')){
        state.saldo = INITIAL; state.lanceAtual=0; state.comprometido=0; state.elenco=[]; state.slots=[]; ensureDefaultSlots(); render();
      }
    });

    // Teclado r√°pido: espa√ßo = lance, Esc = devolver lance, Enter = finalizar
    window.addEventListener('keydown', (e)=>{
      if(e.key===' '){ e.preventDefault(); if(!btnLance.disabled) btnLance.click(); }
      if(e.key==='Escape'){ if(!btnDevolver.disabled) btnDevolver.click(); }
      if(e.key==='Enter' && modal.style.display!=='grid'){ if(!btnFinalizar.disabled) btnFinalizar.click(); }
    });

    // Inicializa
    load();
    ensureDefaultSlots();
    render();
  </script>
</body>
</html>
