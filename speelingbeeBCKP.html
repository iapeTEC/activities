<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Spelling Bee Trainer</title>
  <meta name="theme-color" content="#93c5fd" />
  
  <!--
    ‚ö†Ô∏è FONTE INFANTIL
    Para usar uma fonte como "KB Zipa Dee Doo Dah", coloque os arquivos em /fonts e ajuste a URL abaixo.
    Exemplo: .woff2 e .woff. Mantenha o nome 'KidsFont' para funcionar no CSS.
  -->
  <style>
    @font-face {
      font-family: 'KidsFont';
      src: url('fonts/kidsfont.woff2') format('woff2'),
           url('fonts/kidsfont.woff') format('woff');
      font-display: swap;
    }
  </style>

  <style>
    :root{
      --bg:#fffdf0;           /* fundo amarelinho leve */
      --card:#ffffff;         /* cart√µes */
      --ink:#0f172a;          /* texto principal */
      --muted:#64748b;        /* texto secund√°rio */
      --accent:#93c5fd;       /* azul beb√™ */
      --accent-2:#fde68a;     /* amarelo suave */
      --accent-3:#a89391;     /* marrom claro (vibe giz) */
      --shadow:0 10px 30px rgba(15,23,42,.08);
      --radius:22px;
      --tap:48px;             /* alvo m√≠nimo de toque */
      --maxw:560px;           /* largura tipo app mobile */
    }

    /* Suporte para safe area do iOS */
    @supports(padding: max(0px)) {
      :root {
        --safe-area-inset-left: env(safe-area-inset-left, 0px);
        --safe-area-inset-right: env(safe-area-inset-right, 0px);
      }
    }

    *{box-sizing:border-box}
    html,body{height:100%; margin:0; padding:0; overflow-x:hidden}
    body{
      background:var(--bg); color:var(--ink);
      font-family:KidsFont, ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Ubuntu, Cantarell, "Helvetica Neue", Arial;
      -webkit-text-size-adjust:100%;
      display:flex; justify-content:center;
      /* Adiciona padding lateral respeitando safe area */
      padding-left: max(16px, var(--safe-area-inset-left, 16px));
      padding-right: max(16px, var(--safe-area-inset-right, 16px));
    }

    /* Cont√™iner principal no estilo de aplicativo */
    .app{
      width:100%; max-width:var(--maxw); padding:16px 0; display:grid; grid-template-rows:auto auto 1fr auto; gap:12px;
    }

    /* HEADER com espa√ßo para PNG centralizado */
    header{
      background:var(--accent-2); box-shadow:var(--shadow); border-radius:var(--radius);
      padding:10px 12px; display:flex; align-items:center; justify-content:center; min-height:72px;
    }
    /*
      üîΩ Troque o src abaixo pela sua arte PNG (sem emojis).
      Tamanho recomendado do arquivo: ~600√ó140px com fundo transparente.
    */
    #appLogo{max-width:100%; max-height:48px; height:auto; display:block}

    /* PILL de seletor de classe + status */
    .pill{
      background:var(--accent-3); border:1px solid var(--accent-3); border-radius:999px; padding:10px 12px;
      display:flex; align-items:center; gap:8px; justify-content:space-between;
    }

    /* Grade + status ficam em um card separado logo abaixo do header */
    .toolbar{display:grid; gap:10px}

    select, button{
      appearance:none; border:1px solid #e2e8f0; background:white; padding:12px 14px; border-radius:14px; font-size:16px; color:var(--ink);
      box-shadow:var(--shadow); cursor:pointer; transition:.2s transform ease, .2s box-shadow ease;
      min-height:var(--tap); touch-action:manipulation; -webkit-tap-highlight-color: transparent;
      width:100%;
    }
    select:focus, button:focus{outline:3px solid var(--accent); outline-offset:2px}
    button:hover{transform:translateY(-1px)}
    button:not(.ghost){background:var(--accent-2); border-color:var(--accent-2)}

    /* BOARD principal */
    .board{background:linear-gradient(180deg,#fff 0%,var(--bg) 100%); border-radius:var(--radius); box-shadow:var(--shadow); padding:16px; display:grid; gap:12px}

    .row{display:flex; gap:10px; flex-wrap:wrap; justify-content:center;}

    /* Bot√µes de navega√ß√£o com PNGs (sem emoji) */
    .btn-icon{display:flex; align-items:center; justify-content:center; gap:10px; flex: none; width: 60px; height: 60px; border-radius: 50%;}
    .icon{width:22px; height:22px; display:inline-block}
    /*
      Coloque seus PNGs em /icons e ajuste os src nos <img> abaixo:
      esquerda.png | direita.png | ouvir.png | revelar.png | soletrar.png
      Sugest√£o: exportar a 44px -> o CSS reduz para 22px mantendo nitidez.
    */

    .bigbox{
      border:2px dashed #cbd5e1; border-radius:18px; background:#f8fafc; display:flex; align-items:center; justify-content:center;
      min-height:28vh; font-weight:900; letter-spacing:2px; color:#334155;
      font-size:clamp(28px, 9vw, 64px);
    }

    footer.small{color:var(--muted); font-size:13px}

    /* Barra de dificuldade (apenas TAGs centralizadas) */
    .difficulty{
      background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:12px; display:flex; gap:10px; justify-content:space-around; flex-wrap:wrap;
    }
    .diff-btn{
      flex:none; display:flex; align-items:center; justify-content:center; width:60px; height:60px; border-radius:50%; border:1px solid #e2e8f0; background:#fff; padding:0;
    }
    .tag{
      display:flex; align-items:center; justify-content:center; width:100%; height:100%; border-radius:50%; font-weight:800; font-size:12px;
      overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
    }
    .tag.easy{background:var(--accent-2)}
    .tag.medium{background:var(--accent-2)}          /* corrigido: usava --accent2 por engano */
    .tag.hard{background:var(--accent-2)}
    .diff-btn.active{outline:3px solid #60a5fa}

    /* Status (dificuldade atual + progresso) */
    .status{
      display:flex; gap:10px; align-items:center; justify-content:space-between;
    }
    .status .tag{min-width:84px}

    /* ===== Pills com imagem preenchendo toda a √°rea ===== */
    .controls { gap: 10px; display:flex; flex-wrap:wrap; justify-content:space-around; }
    .controls .btn-pill {
      padding: 0;                 /* sem padding: a imagem encosta nas extremidades visuais */
      border-radius: 999px;       /* formato pill */
      overflow: hidden;           /* evita qualquer vazamento da imagem */
      background: #fff;           /* fundo neutro sob PNG transparente */
      min-height: 56px;           /* altura confort√°vel */
      display: flex; align-items: center; justify-content: center;
      border: 1px solid #e2e8f0;  /* contorno suave igual ao resto */
      box-shadow: var(--shadow); flex:1;
    }
    .controls .btn-pill img.pill-img {
      width: 100%;
      height: 100%;
      object-fit: contain;        /* preenche ao m√°ximo, mantendo propor√ß√£o */
      display: block;
      padding: 6px 10px;          /* quase at√© a borda; ajuste para +/‚àí margem */
    }

    /* Footer com logo da escola (sem container, centralizado) */
    .global-footer{
      background:var(--card); box-shadow:var(--shadow); border-radius:var(--radius);
      padding:12px; display:flex; justify-content:center; align-items:center
    }
    .global-footer img{width:48px; height:auto; display:block}

    /* Acessibilidade visualmente escondido (para r√≥tulos que n√£o aparecem na UI) */
    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}

    /* Ajustes finos para telas muito pequenas */
    @media (max-width:420px){
      .status{flex-direction:column; align-items:stretch}
      .bigbox{min-height:24vh}
      .controls .btn-pill { min-height: 60px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <!-- PNG DO T√çTULO DO APP: substitua o src pela sua arte (sem emojis) -->
      <img id="appLogo" src="app-title.png" alt="Spelling Bee" />
    </header>

    <section class="toolbar">
      <div class="pill">
        <label for="gradeSelect"><strong>Classe:</strong></label>
        <select id="gradeSelect" aria-label="Escolher classe">
          <option value="3rd">3rd Grade</option>
          <option value="4th">4th Grade</option>
          <option value="5th">5th Grade</option>
        </select>
      </div>

      <div class="status">
        <span class="tag easy" id="difficultyTag">easy</span>
        <span id="progressText">1 / 1</span>
      </div>
    </section>

    <!-- DIFICULDADE: apenas TAG centralizada (sem texto duplicado) -->
    <nav class="difficulty" aria-label="N√≠vel de dificuldade">
      <button class="diff-btn" data-diff="easy" id="btnEasy" aria-label="Easy">
        <span class="tag easy">EASY</span>
      </button>
      <button class="diff-btn" data-diff="medium" id="btnMedium" aria-label="Medium">
        <span class="tag medium">MEDIUM</span>
      </button>
      <button class="diff-btn" data-diff="hard" id="btnHard" aria-label="Hard">
        <span class="tag hard">HARD</span>
      </button>
      <button class="diff-btn" data-diff="auto" id="btnAuto" aria-label="Autom√°tico">
        <span class="tag">AUTO</span>
      </button>
    </nav>

    <main>
      <section class="board" aria-live="polite">
        <div class="row">
          <!-- Substitua os src pelos seus PNGs de setas -->
          <button id="prevBtn" class="btn-pill ghost" title="Palavra anterior" aria-label="Palavra anterior">
            <img class="icon" src="esquerda.png" alt="Anterior" />
            <span class="sr-only">Palavra anterior</span>
          </button>
          <button id="nextBtn" class="btn-pill ghost" title="Pr√≥xima palavra" aria-label="Pr√≥xima palavra">
            <img class="icon" src="direita.png" alt="Pr√≥xima" />
            <span class="sr-only">Pr√≥xima palavra</span>
          </button>
        </div>

        <div class="bigbox" id="mysteryBox" aria-label="Caixa de palavra">?</div>

        <!-- Pills preenchidos por imagens -->
        <div class="controls">
          <!-- Troque os src pelos seus PNGs (arte horizontal) -->
          <button id="hearBtn" class="btn-pill ghost" aria-label="Ouvir novamente a palavra">
            <img class="pill-img" src="ouvir.png" alt="Ouvir novamente a palavra" />
          </button>

          <button id="revealBtn" class="btn-pill" aria-label="Revelar a palavra">
            <img class="pill-img" src="revelar.png" alt="Revelar a palavra" />
          </button>

          <button id="spellBtn" class="btn-pill" aria-label="Soletrar a palavra">
            <img class="pill-img" src="soletrar.png" alt="Soletrar a palavra" />
          </button>
        </div>

        <footer class="small" id="infoText">Selecione uma classe e toque em "Pr√≥xima palavra". A palavra ser√° falada em ingl√™s e ficar√° oculta.</footer>
      </section>
    </main>

    <footer class="global-footer">
      <!-- LOGO DA ESCOLA (sem container, centralizada) -->
      <img src="school-logo.png" alt="School logo" loading="lazy" decoding="async" width="48" height="48" />
    </footer>
  </div>

  <script>
    // =====================
    // 1) BANCO DE PALAVRAS
    // =====================
    const WORDS = {
      '3rd': {
        easy: [
          "alone","angel","bad","base","bear","bed","best","better","calf","cook","cub","cup","daisy","deaf","deer","den","desk","door","drink","dust","egg","face","fast","fight","firm","fun","games","glitter","high","ice","keep","kind","kiwi","koala","lake","law","lunch","make","movie","noon","pain","panda","parts","plan","plate","prize","rest","rug","shop","sink","sofa","sport","storm","stove","sure","tag","think","towel","wake","wash","wave","win","yard","zoo"
        ],
        medium: [
          "adult","after","athlete","barking","bedroom","blanket","bounces","busy","catch","charade","chosen","clay","conquer","cylinder","division","donate","drums","eagle","early","eggshell","exercise","faced","famine","female","finally","fluffy","flow","forgive","gallop","garage","governor","grace","goggles","guitar","hide-and-seek","identify","jealous","jumper","kicks","kilos","kitchen","leader","letters","lifestyle","loam","mammals","marathon","meal","mouth","myself","news","option","ostrich","owl","pillow","planning","poem","pool","powerful","prey","priests","pyramid","quantity","quotient","recite","respect","roof","running","scared","score","seals","several","service","shop","shout","sing","soccer","steps","stream","survive","swimming","table","television","tender","totally","training","trumpet","unique","waiting","winner","wolf","zebra"
        ],
        hard: [
          "adolescent","apostle","appointment","badness","became","blue whale","choices","coldest","comic strip","comfortable","communicate","competition","creatures","decorative","divisor","excellent","expressions","freedom","frequency","furniture","geometric","happening","hardworking","hatching","height","homework","inclusive","independent","integrity","kangaroo","largest","length","lioness","llamas","measure","merchants","newborn","nutrient","pharaoh","possible","preparation","purifies","recognize","refrigerator","research","serves","situation","smallest","sometimes","speaking","tenderness","unfortunately","vacation","vacuum"
        ]
      },
      '4th': {
        easy: [
          "back","bell","better","bowl","boy","butter","butterfly","camel","cents","change","chocolate","city","coin(s)","crayons","cry","cup","diet","east","eraser","facts","fall","field","food","fork","fun","get on /","get off","gift","girl","glad","glue","go to","gold","happy","hair","heart","help","joy","knife","laugh","like","man","mall","map","meat","moon","mother","music","others","pan","paper","park","pen","penny","pet store","photo","pizza","poor","race","raise","rich","rug","ruler","salad","seed","short","silver","small","smart","soft","sorry","soup","spoon","stamp","sure","thing","trick","water","west","year"
        ],
        medium: [
          "arrival","athlete","attention","backpack","bakery","bored","brother","buying","cabbage","caring","celebrate","cheer","cheerful","content","collector","definitely","describe","detect","difficult","dishonest","driving","earth","eraser","English book","especially","example","expert","fable","farmer","favorite","finish","flour","fresh","friendly","glasses","grateful","greeting","hobby","helpful","hospital","honey","ingredients","joyful","kind","kindness","kittens","liar","listener","litter","loving","main","marker","neighbor","nutritious","oatmeal","older","patient","position","postcard","prepare","protein","reminder","restaurant","responsible","savory","sheep","shout","teacher","tired","unhappy","uniform","upset","vacation","village","visible","vision","windy","winner","wool"
        ],
        hard: [
          "birthday","calories","carefully","carbohydrates","celebration","chocolate chips","classmates","consumer","countryside","delicious","directly","encouragement","exciting","everything","granddaughter","handwritten","highlighted","ingredients","interrupted","mistakes","occupation","opposite","organization","peripheral","pharmacy","postcard","preaching","preparation","producers","quaternary","remembering","responsible","secondary","sheepfold","shepherd","supermarket","tertiary","tradition","trustworthy","understanding","utensils","vanilla","wheelchair"
        ]
      },
      '5th': {
        easy: [
          "add","air","apple","bad","bag","belt","best","body","bush","care","chair","clean","clear","color","cool","cough","cut","dance","deep","drop","dry","end","error","fake","family","fast","fever","felt","filter","fish","friend","found","fun","game","garden","gift","girl","glad","gold","idea","kind","lake","light","lost","made","more","mouth","note","nose","open","pain","real","right","rule","run/ran","same","school","sea","sick","sky","soil","star","stop","storm","sun","teacher","time","trip","try","vomit","warm","wash","waves","wind","wrong","yard"
        ],
        medium: [
          "adventure","afraid","afternoon","amazing","ancient","another","apologize","average","avoid","bacteria","balloon","barley","calculate","captain","closer","clothes","condition","continue","dangerous","diabetes","diarrhea","discover","disease","easier","evening","explorer","faster","faucet","figurative","findings","forgot","forever","gently","habits","harder","harvest","helpful","history","laughter","lifestyle","machine","mystery","necessary","noticed","options","outside","parasites","peaceful","physical","planet","position","powerful","protect","reasons","refreshing","secret","should","someone","station","stretch","sunlight","thorny","thirsty","viruses","worship","worried"
        ],
        hard: [
          "authorities","carded","choked","cholera","circulatory","contaminated","crowd","cultures","dedication","domesticated","electric","expensive","experiment","fruitful","handmade","imaginary","independence","invention","measuring","metaphor","microscope","mineral","multiply","normally","ongoing","overboard","parables","perseverance","phenomenon","potable","running away","scattering","servant","shearing","strategy","terrifying","thought","thousands","throw up","tornadoes","underwater","vomiting","whirlwinds"
        ]
      }
    };

    // ============================
    // 2) ESTADO + UTILIT√ÅRIOS
    // ============================
    const els = {
      gradeSelect: document.getElementById('gradeSelect'),
      difficultyTag: document.getElementById('difficultyTag'),
      progressText: document.getElementById('progressText'),
      mysteryBox: document.getElementById('mysteryBox'),
      infoText: document.getElementById('infoText'),
      next: document.getElementById('nextBtn'),
      prev: document.getElementById('prevBtn'),
      hear: document.getElementById('hearBtn'),
      reveal: document.getElementById('revealBtn'),
      spell: document.getElementById('spellBtn'),
      btnEasy: document.getElementById('btnEasy'),
      btnMedium: document.getElementById('btnMedium'),
      btnHard: document.getElementById('btnHard'),
      btnAuto: document.getElementById('btnAuto')
    };

    const state = {
      grade: localStorage.getItem('sb.grade') || '3rd',
      mode: localStorage.getItem('sb.mode') || 'auto', // 'easy' | 'medium' | 'hard' | 'auto'
      index: 0,
      revealed: false,
      voices: [],
      voice: null
    };

    function getListForState(){
      const g = WORDS[state.grade];
      const order = state.mode==='auto' ? ['easy','medium','hard'] : [state.mode];
      const list = order.flatMap(key => g[key]);
      return { list, order, lengths: order.map(key => g[key].length) };
    }

    function currentWord(){
      return getListForState().list[state.index] || '';
    }

    function currentDifficulty(){
      const {order, lengths} = getListForState();
      let i = state.index;
      for(let k=0;k<lengths.length;k++){
        if(i < lengths[k]) return order[k];
        i -= lengths[k];
      }
      return order[order.length-1] || 'easy';
    }

    function updateUI(){
      const { list } = getListForState();
      const word = currentWord();
      const diff = currentDifficulty();

      // mystery box
      els.mysteryBox.textContent = state.revealed ? word : '?';

      // tags
      els.difficultyTag.textContent = diff;
      els.difficultyTag.className = `tag ${diff}`;

      // progress
      els.progressText.textContent = `${Math.min(state.index+1, list.length)} / ${list.length}`;

      // dificuldade ativa (borda/outline)
      [els.btnEasy, els.btnMedium, els.btnHard, els.btnAuto].forEach(b=>b.classList.remove('active'));
      ({easy:els.btnEasy, medium:els.btnMedium, hard:els.btnHard, auto:els.btnAuto}[state.mode]).classList.add('active');

      // desabilitar bordas de navega√ß√£o
      els.prev.disabled = state.index<=0;
      els.next.disabled = state.index>=list.length-1;
    }

    function savePrefs(){
      localStorage.setItem('sb.grade', state.grade);
      localStorage.setItem('sb.mode', state.mode);
    }

    // ============================
    // 3) VOZ (ElevenLabs priorit√°rio, fallback para Web Speech)
    // ============================
    const ELEVENLABS_API_KEY = 'sk_ba46f77c908c7536543cfc2d3974e387ef1e26d3862d824d'; // Pegue no elevenlabs.io ap√≥s cadastro
    let currentAudio = null;

    // Carrega vozes para Web Speech (fallback)
    function loadVoices(){
      state.voices = window.speechSynthesis.getVoices();
      const preferred = state.voices.filter(v => v.lang && v.lang.toLowerCase().startsWith('en'));
      state.voice = preferred.find(v=>/Google US English|Microsoft.+(Aria|Guy|Jenny|Ryan)/i.test(v.name))
                  || preferred.find(v=>/US|GB|English/i.test(v.name))
                  || preferred[0]
                  || null;
    }
    window.speechSynthesis.onvoiceschanged = loadVoices; loadVoices();

    // TTS fallback com Web Speech
    function speakFallback(text, {rate=0.9, pitch=1.0}={}){
      if(!('speechSynthesis' in window)){
        warn('Seu navegador n√£o suporta TTS.');
        return;
      }
      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = (state.voice && state.voice.lang) || 'en-US';
      u.voice = state.voice; u.rate = rate; u.pitch = pitch; u.volume = 1.0;
      window.speechSynthesis.speak(u);
    }

    function spellOutFallback(word){
      if(!('speechSynthesis' in window)) return;
      window.speechSynthesis.cancel();
      const tokens = normalizeForSpelling(word);
      const u = new SpeechSynthesisUtterance(tokens.join(', '));
      u.lang = (state.voice && state.voice.lang) || 'en-US';
      u.voice = state.voice; u.rate = 0.78; u.pitch = 1.05;
      window.speechSynthesis.speak(u);
    }

    // TTS com ElevenLabs (principal)
    async function speak(text) {
      if (currentAudio) {
        currentAudio.pause();
        currentAudio = null;
      }

      try {
        const response = await fetch('https://api.elevenlabs.io/v1/text-to-speech/21m00Tcm4TlvDq8ikWAM/stream', { // Voz padr√£o gratuita; mude ID para outra voz free
          method: 'POST',
          headers: {
            'Accept': 'audio/mpeg',
            'Content-Type': 'application/json',
            'xi-api-key': ELEVENLABS_API_KEY
          },
          body: JSON.stringify({
            text: text,
            model_id: 'eleven_monolingual_v1',
            voice_settings: {
              stability: 0.5,
              similarity_boost: 0.5
            }
          })
        });

        if (!response.ok) throw new Error('Erro na API ElevenLabs');

        const audioBlob = await response.blob();
        const audioUrl = URL.createObjectURL(audioBlob);
        currentAudio = new Audio(audioUrl);
        currentAudio.play().catch(error => {
          console.error('Erro no √°udio:', error);
          warn('Erro no TTS avan√ßado. Usando TTS nativo.');
          speakFallback(text);
        });
      } catch (error) {
        console.error('Erro ElevenLabs:', error);
        warn('Erro no TTS avan√ßado (verifique key/limite). Usando TTS nativo.');
        speakFallback(text);
      }
    }

    function normalizeForSpelling(w){
      const tokens = [];
      for(const ch of w){
        if(/[a-z]/i.test(ch)) tokens.push(ch.toUpperCase());
        else if(ch===' ') tokens.push('space');
        else if(ch==='-') tokens.push('hyphen');
        else if(ch==='/') tokens.push('slash');
        else if(ch==='\'') tokens.push('apostrophe');
      }
      return tokens;
    }

    async function spellOut(word){
      if (currentAudio) {
        currentAudio.pause();
        currentAudio = null;
      }

      const tokens = normalizeForSpelling(word);
      const spellingText = tokens.join(', ');

      try {
        const response = await fetch('https://api.elevenlabs.io/v1/text-to-speech/21m00Tcm4TlvDq8ikWAM/stream', {
          method: 'POST',
          headers: {
            'Accept': 'audio/mpeg',
            'Content-Type': 'application/json',
            'xi-api-key': ELEVENLABS_API_KEY
          },
          body: JSON.stringify({
            text: spellingText,
            model_id: 'eleven_monolingual_v1',
            voice_settings: {
              stability: 0.5,
              similarity_boost: 0.5
            }
          })
        });

        if (!response.ok) throw new Error('Erro na API ElevenLabs');

        const audioBlob = await response.blob();
        const audioUrl = URL.createObjectURL(audioBlob);
        currentAudio = new Audio(audioUrl);
        currentAudio.play().catch(error => {
          console.error('Erro no √°udio:', error);
          warn('Erro no TTS avan√ßado. Usando TTS nativo.');
          spellOutFallback(word);
        });
      } catch (error) {
        console.error('Erro ElevenLabs:', error);
        warn('Erro no TTS avan√ßado (verifique key/limite). Usando TTS nativo.');
        spellOutFallback(word);
      }
    }

    function warn(msg){
      document.getElementById('infoText').textContent = msg;
    }

    // ============================
    // 4) A√á√ïES
    // ============================
    function go(delta){
      const { list } = getListForState();
      const next = Math.max(0, Math.min(list.length-1, state.index + delta));
      if(next!==state.index){
        state.index = next; state.revealed = false; updateUI();
        speak(currentWord());
      }
    }

    function chooseGrade(g){ state.grade = g; state.index = 0; state.revealed = false; savePrefs(); updateUI(); }
    function chooseMode(m){ state.mode = m; state.index = 0; state.revealed = false; savePrefs(); updateUI(); }

    // ============================
    // 5) EVENTOS
    // ============================
    els.gradeSelect.addEventListener('change', e=> chooseGrade(e.target.value));
    els.btnEasy.addEventListener('click', ()=>chooseMode('easy'));
    els.btnMedium.addEventListener('click', ()=>chooseMode('medium'));
    els.btnHard.addEventListener('click', ()=>chooseMode('hard'));
    els.btnAuto.addEventListener('click', ()=>chooseMode('auto'));

    document.getElementById('nextBtn').addEventListener('click', ()=>{ go(+1); });
    document.getElementById('prevBtn').addEventListener('click', ()=>{ go(-1); });

    document.getElementById('hearBtn').addEventListener('click', ()=> speak(currentWord()));
    document.getElementById('revealBtn').addEventListener('click', ()=>{ state.revealed = true; updateUI(); });
    document.getElementById('spellBtn').addEventListener('click', ()=> spellOut(currentWord()));

    // Primeira carga
    (function init(){
      els.gradeSelect.value = state.grade; updateUI();
      warn('Dica: toque em "Pr√≥xima palavra" ‚Äî a palavra ser√° falada e ficar√° oculta at√© voc√™ revelar.');
    })();
  </script>
</body>
</html>