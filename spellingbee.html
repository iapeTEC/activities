<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Spelling Bee Trainer</title>
  <meta name="theme-color" content="#93c5fd" />
  
  <!-- Fonte infantil (opcional) -->
  <style>
    @font-face {
      font-family: 'KidsFont';
      src: url('fonts/kidsfont.woff2') format('woff2'),
           url('fonts/kidsfont.woff') format('woff');
      font-display: swap;
    }
  </style>

  <style>
    :root{
      --bg:#fffdf0;           /* fundo amarelinho leve */
      --card:#ffffff;         /* cartões */
      --ink:#0f172a;          /* texto principal */
      --muted:#64748b;        /* texto secundário */
      --accent:#93c5fd;       /* azul bebê */
      --accent-2:#fde68a;     /* amarelo suave */
      --accent-3:#a89391;     /* marrom claro (vibe giz) */
      --shadow:0 10px 30px rgba(15,23,42,.08);
      --radius:22px;
      --tap:48px;             /* alvo mínimo de toque */
      --maxw:560px;           /* largura tipo app mobile */
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font-family:KidsFont, ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Ubuntu, Cantarell, "Helvetica Neue", Arial;
      -webkit-text-size-adjust:100%;
      display:flex; justify-content:center; /* centra o app */
      overflow-x:hidden; /* evita qualquer “vazamento” lateral */
    }

    img{max-width:100%; height:auto; display:block}

    /* Contêiner principal no estilo de aplicativo */
    .app{
      width:100%; max-width:var(--maxw); padding:16px; display:grid; grid-template-rows:auto auto 1fr auto; gap:12px;
      margin:0 auto;
    }

    /* HEADER com espaço para PNG centralizado (sem título em texto) */
    header{
      background:var(--accent-2); box-shadow:var(--shadow); border-radius:var(--radius);
      padding:10px 12px; display:flex; align-items:center; justify-content:center; min-height:72px;
    }
    /* Troque o src abaixo pela sua arte PNG */
    #appLogo{max-width:100%; max-height:48px}

    /* PILL de seletor de classe + status */
    .pill{
      background:var(--accent-3); border:1px solid var(--accent-3); border-radius:999px; padding:10px 12px;
      display:flex; align-items:center; gap:8px; justify-content:space-between;
    }

    /* Grade + status ficam em um card separado logo abaixo do header */
    .toolbar{display:grid; gap:10px}

    select, button{
      appearance:none; border:1px solid #e2e8f0; background:white; padding:12px 14px; border-radius:14px; font-size:16px; color:var(--ink);
      box-shadow:var(--shadow); cursor:pointer; transition:.2s transform ease, .2s box-shadow ease;
      min-height:var(--tap); touch-action:manipulation; -webkit-tap-highlight-color: transparent;
      width:100%;
    }
    select:focus, button:focus{outline:3px solid var(--accent); outline-offset:2px}
    button:hover{transform:translateY(-1px)}
    button:not(.ghost){background:var(--accent-2); border-color:var(--accent-2)}

    /* BOARD principal */
    .board{background:linear-gradient(180deg,#fff 0%,var(--bg) 100%); border-radius:var(--radius); box-shadow:var(--shadow); padding:16px; display:grid; gap:12px}

    .row{display:flex; gap:10px; flex-wrap:wrap}

    /* Botões de navegação (ícones PNG) */
    .btn-icon{display:flex; align-items:center; justify-content:center; gap:10px; width:auto}
    .icon{width:22px; height:22px; display:inline-block}

    .bigbox{
      border:2px dashed #cbd5e1; border-radius:18px; background:#f8fafc; display:flex; align-items:center; justify-content:center;
      min-height:28vh; font-weight:900; letter-spacing:2px; color:#334155;
      font-size:clamp(28px, 9vw, 64px);
    }

    footer.small{color:var(--muted); font-size:13px}

    /* Barra de dificuldade (apenas TAGs centralizadas) */
    .difficulty{
      background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:12px; display:flex; gap:10px; justify-content:space-between;
    }
    .diff-btn{
      flex:1; display:flex; align-items:center; justify-content:center; padding:8px 10px; border-radius:14px; border:1px solid #e2e8f0; background:#fff;
    }
    .tag{display:inline-flex; align-items:center; justify-content:center; padding:8px 12px; border-radius:999px; font-weight:800; font-size:14px}
    .tag.easy{background:var(--accent-2)}
    .tag.medium{background:var(--accent)}          /* azul bebê */
    .tag.hard{background:var(--accent-2)}
    .diff-btn.active{outline:3px solid #60a5fa}

    /* Status (dificuldade atual + progresso) */
    .status{
      display:flex; gap:10px; align-items:center; justify-content:space-between;
    }
    .status .tag{min-width:84px}

    /* ===== Pills de ação com imagem preenchendo toda a área ===== */
    .controls { gap: 10px; }
    .controls .btn-pill {
      padding: 0;                 /* encosta nas extremidades visuais do pill */
      border-radius: 999px;       /* formato pill */
      overflow: hidden;           /* evita vazamento da imagem */
      background: #fff;           /* fundo neutro sob PNG transparente */
      min-height: 56px;           /* altura confortável */
      display: flex; align-items: center; justify-content: center;
      border: 1px solid #e2e8f0;  /* contorno suave */
      box-shadow: var(--shadow);
      flex: 1 1 0;                /* largura igual entre os três */
    }
    .controls .btn-pill img.pill-img {
      width: 100%;
      height: 100%;
      object-fit: contain;        /* preenche ao máximo, mantendo proporção */
      display: block;
      padding: 6px 10px;          /* quase até a borda; reduza p/ 4px/0 se quiser ainda mais rente */
      box-sizing: border-box;     /* padding conta dentro do tamanho */
    }

    /* Footer com logo da escola (sem container, centralizado) */
    .global-footer{
      background:var(--card); box-shadow:var(--shadow); border-radius:var(--radius);
      padding:12px; display:flex; justify-content:center; align-items:center
    }
    .global-footer img{width:48px; height:auto; display:block}

    /* Acessibilidade (itens apenas para leitores de tela) */
    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}

    /* Ajustes para telas muito pequenas */
    @media (max-width:380px){
      .status{flex-direction:column; align-items:stretch}
      .difficulty{flex-direction:column}
      .bigbox{min-height:24vh}
      .controls .btn-pill { min-height: 60px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <!-- PNG DO TÍTULO DO APP -->
      <img id="appLogo" src="app-title.png" alt="Spelling Bee" />
    </header>

    <section class="toolbar">
      <div class="pill">
        <label for="gradeSelect"><strong>Classe:</strong></label>
        <select id="gradeSelect" aria-label="Escolher classe">
          <option value="3rd">3rd Grade</option>
          <option value="4th">4th Grade</option>
          <option value="5th">5th Grade</option>
        </select>
      </div>

      <div class="status">
        <span class="tag easy" id="difficultyTag">easy</span>
        <span id="progressText">1 / 1</span>
      </div>
    </section>

    <!-- DIFICULDADE: apenas TAG centralizada (sem texto duplicado) -->
    <nav class="difficulty" aria-label="Nível de dificuldade">
      <button class="diff-btn" data-diff="easy" id="btnEasy" aria-label="Easy">
        <span class="tag easy">EASY</span>
      </button>
      <button class="diff-btn" data-diff="medium" id="btnMedium" aria-label="Medium">
        <span class="tag medium">MEDIUM</span>
      </button>
      <button class="diff-btn" data-diff="hard" id="btnHard" aria-label="Hard">
        <span class="tag hard">HARD</span>
      </button>
      <button class="diff-btn" data-diff="auto" id="btnAuto" aria-label="Automático">
        <span class="tag">AUTO</span>
      </button>
    </nav>

    <main>
      <section class="board" aria-live="polite">
        <div class="row">
          <!-- Setas PNG -->
          <button id="prevBtn" class="btn-icon" title="Palavra anterior" aria-label="Palavra anterior">
            <img class="icon" src="esquerda.png" alt="Anterior" />
            <span class="sr-only">Palavra anterior</span>
          </button>
          <button id="nextBtn" class="btn-icon" title="Próxima palavra" aria-label="Próxima palavra">
            <img class="icon" src="direita.png" alt="Próxima" />
            <span class="sr-only">Próxima palavra</span>
          </button>
        </div>

        <div class="bigbox" id="mysteryBox" aria-label="Caixa de palavra">?</div>

        <!-- Pills de ação com imagem preenchendo -->
        <div class="row controls">
          <button id="hearBtn" class="btn-pill ghost" aria-label="Ouvir novamente a palavra">
            <img class="pill-img" src="ouvir.png" alt="Ouvir novamente a palavra" />
          </button>

          <button id="revealBtn" class="btn-pill" aria-label="Revelar a palavra">
            <img class="pill-img" src="revelar.png" alt="Revelar a palavra" />
          </button>

          <button id="spellBtn" class="btn-pill" aria-label="Soletrar a palavra">
            <img class="pill-img" src="soletrar.png" alt="Soletrar a palavra" />
          </button>
        </div>

        <footer class="small" id="infoText">Selecione uma classe e toque em “Próxima palavra”. A palavra será falada em inglês e ficará oculta.</footer>
      </section>
    </main>

    <footer class="global-footer">
      <!-- LOGO DA ESCOLA (sem container, centralizada) -->
      <img src="school-logo.png" alt="School logo" loading="lazy" decoding="async" width="48" height="48" />
    </footer>
  </div>

  <script>
    // =====================
    // 1) BANCO DE PALAVRAS
    // =====================
    const WORDS = {
      '3rd': {
        easy: [
          "alone","angel","bad","base","bear","bed","best","better","calf","cook","cub","cup","daisy","deaf","deer","den","desk","door","drink","dust","egg","face","fast","fight","firm","fun","games","glitter","high","ice","keep","kind","kiwi","koala","lake","law","lunch","make","movie","noon","pain","panda","parts","plan","plate","prize","rest","rug","shop","sink","sofa","sport","storm","stove","sure","tag","think","towel","wake","wash","wave","win","yard","zoo"
        ],
        medium: [
          "adult","after","athlete","barking","bedroom","blanket","bounces","busy","catch","charade","chosen","clay","conquer","cylinder","division","donate","drums","eagle","early","eggshell","exercise","faced","famine","female","finally","fluffy","flow","forgive","gallop","garage","governor","grace","goggles","guitar","hide-and-seek","identify","jealous","jumper","kicks","kilos","kitchen","leader","letters","lifestyle","loam","mammals","marathon","meal","mouth","myself","news","option","ostrich","owl","pillow","planning","poem","pool","powerful","prey","priests","pyramid","quantity","quotient","recite","respect","roof","running","scared","score","seals","several","service","shop","shout","sing","soccer","steps","stream","survive","swimming","table","television","tender","totally","training","trumpet","unique","waiting","winner","wolf","zebra"
        ],
        hard: [
          "adolescent","apostle","appointment","badness","became","blue whale","choices","coldest","comic strip","comfortable","communicate","competition","creatures","decorative","divisor","excellent","expressions","freedom","frequency","furniture","geometric","happening","hardworking","hatching","height","homework","inclusive","independent","integrity","kangaroo","largest","length","lioness","llamas","measure","merchants","newborn","nutrient","pharaoh","possible","preparation","purifies","recognize","refrigerator","research","serves","situation","smallest","sometimes","speaking","tenderness","unfortunately","vacation","vacuum"
        ]
      },
      '4th': {
        easy: [
          "back","bell","better","bowl","boy","butter","butterfly","camel","cents","change","chocolate","city","coin(s)","crayons","cry","cup","diet","east","eraser","facts","fall","field","food","fork","fun","get on /","get off","gift","girl","glad","glue","go to","gold","happy","hair","heart","help","joy","knife","laugh","like","man","mall","map","meat","moon","mother","music","others","pan","paper","park","pen","penny","pet store","photo","pizza","poor","race","raise","rich","rug","ruler","salad","seed","short","silver","small","smart","soft","sorry","soup","spoon","stamp","sure","thing","trick","water","west","year"
        ],
        medium: [
          "arrival","athlete","attention","backpack","bakery","bored","brother","buying","cabbage","caring","celebrate","cheer","cheerful","content","collector","definitely","describe","detect","difficult","dishonest","driving","earth","eraser","English book","especially","example","expert","fable","farmer","favorite","finish","flour","fresh","friendly","glasses","grateful","greeting","hobby","helpful","hospital","honey","ingredients","joyful","kind","kindness","kittens","liar","listener","litter","loving","main","marker","neighbor","nutritious","oatmeal","older","patient","position","postcard","prepare","protein","reminder","restaurant","responsible","savory","sheep","shout","teacher","tired","unhappy","uniform","upset","vacation","village","visible","vision","windy","winner","wool"
        ],
        hard: [
          "birthday","calories","carefully","carbohydrates","celebration","chocolate chips","classmates","consumer","countryside","delicious","directly","encouragement","exciting","everything","granddaughter","handwritten","highlighted","ingredients","interrupted","mistakes","occupation","opposite","organization","peripheral","pharmacy","postcard","preaching","preparation","producers","quaternary","remembering","responsible","secondary","sheepfold","shepherd","supermarket","tertiary","tradition","trustworthy","understanding","utensils","vanilla","wheelchair"
        ]
      },
      '5th': {
        easy: [
          "add","air","apple","bad","bag","belt","best","body","bush","care","chair","clean","clear","color","cool","cough","cut","dance","deep","drop","dry","end","error","fake","family","fast","fever","felt","filter","fish","friend","found","fun","game","garden","gift","girl","glad","gold","idea","kind","lake","light","lost","made","more","mouth","note","nose","open","pain","real","right","rule","run/ran","same","school","sea","sick","sky","soil","star","stop","storm","sun","teacher","time","trip","try","vomit","warm","wash","waves","wind","wrong","yard"
        ],
        medium: [
          "adventure","afraid","afternoon","amazing","ancient","another","apologize","average","avoid","bacteria","balloon","barley","calculate","captain","closer","clothes","condition","continue","dangerous","diabetes","diarrhea","discover","disease","easier","evening","explorer","faster","faucet","figurative","findings","forgot","forever","gently","habits","harder","harvest","helpful","history","laughter","lifestyle","machine","mystery","necessary","noticed","options","outside","parasites","peaceful","physical","planet","position","powerful","protect","reasons","refreshing","secret","should","someone","station","stretch","sunlight","thorny","thirsty","viruses","worship","worried"
        ],
        hard: [
          "authorities","carded","choked","cholera","circulatory","contaminated","crowd","cultures","dedication","domesticated","electric","expensive","experiment","fruitful","handmade","imaginary","independence","invention","measuring","metaphor","microscope","mineral","multiply","normally","ongoing","overboard","parables","perseverance","phenomenon","potable","running away","scattering","servant","shearing","strategy","terrifying","thought","thousands","throw up","tornadoes","underwater","vomiting","whirlwinds"
        ]
      }
    };

    // ============================
    // 2) ESTADO + UTILITÁRIOS
    // ============================
    const els = {
      gradeSelect: document.getElementById('gradeSelect'),
      difficultyTag: document.getElementById('difficultyTag'),
      progressText: document.getElementById('progressText'),
      mysteryBox: document.getElementById('mysteryBox'),
      infoText: document.getElementById('infoText'),
      next: document.getElementById('nextBtn'),
      prev: document.getElementById('prevBtn'),
      hear: document.getElementById('hearBtn'),
      reveal: document.getElementById('revealBtn'),
      spell: document.getElementById('spellBtn'),
      btnEasy: document.getElementById('btnEasy'),
      btnMedium: document.getElementById('btnMedium'),
      btnHard: document.getElementById('btnHard'),
      btnAuto: document.getElementById('btnAuto')
    };

    const state = {
      grade: localStorage.getItem('sb.grade') || '3rd',
      mode: localStorage.getItem('sb.mode') || 'auto', // 'easy' | 'medium' | 'hard' | 'auto'
      index: 0,
      revealed: false,
      voices: [],
      voice: null,
      ttsUnlocked: false
    };

    function getListForState(){
      const g = WORDS[state.grade];
      const order = state.mode==='auto' ? ['easy','medium','hard'] : [state.mode];
      const list = order.flatMap(key => g[key]);
      return { list, order, lengths: order.map(key => g[key].length) };
    }

    function currentWord(){
      return getListForState().list[state.index] || '';
    }

    function currentDifficulty(){
      const {order, lengths} = getListForState();
      let i = state.index;
      for(let k=0;k<lengths.length;k++){
        if(i < lengths[k]) return order[k];   // ✅ corrigido (antes estava i <_lengths[k])
        i -= lengths[k];
      }
      return order[order.length-1] || 'easy';
    }

    function updateUI(){
      const { list } = getListForState();
      const word = currentWord();
      const diff = currentDifficulty();

      // mystery box
      els.mysteryBox.textContent = state.revealed ? word : '?';

      // tags
      els.difficultyTag.textContent = diff;
      els.difficultyTag.className = `tag ${diff}`;

      // progress
      els.progressText.textContent = `${Math.min(state.index+1, list.length)} / ${list.length}`;

      // dificuldade ativa
      [els.btnEasy, els.btnMedium, els.btnHard, els.btnAuto].forEach(b=>b.classList.remove('active'));
      ({easy:els.btnEasy, medium:els.btnMedium, hard:els.btnHard, auto:els.btnAuto}[state.mode]).classList.add('active');

      // nav edges
      els.prev.disabled = state.index<=0;
      els.next.disabled = state.index>=list.length-1;
    }

    function savePrefs(){
      localStorage.setItem('sb.grade', state.grade);
      localStorage.setItem('sb.mode', state.mode);
    }

    // ============================
    // 3) VOZ (Web Speech API) — iOS friendly
    // ============================
    function loadVoices(){
      state.voices = window.speechSynthesis.getVoices() || [];
      const preferred = state.voices.filter(v => v.lang && v.lang.toLowerCase().startsWith('en'));
      state.voice = preferred.find(v=>/Google US English|Microsoft.+(Aria|Guy|Jenny|Ryan)/i.test(v.name))
               || preferred.find(v=>/US|GB|English/i.test(v.name))
               || preferred[0]
               || null;
    }
    window.speechSynthesis.onvoiceschanged = () => { loadVoices(); };

    // Garante que as vozes estejam disponíveis antes de falar
    function ensureVoicesReady(timeoutMs=1200){
      return new Promise(resolve=>{
        const start = Date.now();
        (function wait(){
          loadVoices();
          if(state.voices.length>0 || Date.now()-start>timeoutMs) return resolve();
          setTimeout(wait, 60);
        })();
      });
    }

    // Desbloqueia TTS no primeiro toque (iOS exige gesto do usuário)
    async function unlockTTS(){
      if(state.ttsUnlocked) return;
      await ensureVoicesReady();
      try{
        const u = new SpeechSynthesisUtterance(' ');
        u.volume = 0; // inaudível
        u.rate = 1; u.pitch = 1;
        window.speechSynthesis.speak(u);
      }catch(e){}
      state.ttsUnlocked = true;
    }

    async function speak(text, {rate=0.9, pitch=1.0}={}){
      if(!('speechSynthesis' in window)) { warn('Seu navegador não suporta síntese de voz.'); return; }
      await unlockTTS();
      await ensureVoicesReady();
      try{
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(text);
        u.lang = (state.voice && state.voice.lang) || 'en-US';
        u.voice = state.voice || null;
        u.rate = rate; u.pitch = pitch; u.volume = 1.0;
        window.speechSynthesis.speak(u);
      }catch(e){}
    }

    function normalizeForSpelling(w){
      const tokens = [];
      for(const ch of w){
        if(/[a-z]/i.test(ch)) tokens.push(ch.toUpperCase());
        else if(ch===' ') tokens.push('space');
        else if(ch==='-') tokens.push('hyphen');
        else if(ch==='/') tokens.push('slash');
        else if(ch==='\'') tokens.push('apostrophe');
      }
      return tokens;
    }

    async function spellOut(word){
      if(!('speechSynthesis' in window)) return;
      await unlockTTS();
      await ensureVoicesReady();
      try{
        window.speechSynthesis.cancel();
        // iOS se comporta melhor com um único utterance longo (pausas por vírgula)
        const u = new SpeechSynthesisUtterance(normalizeForSpelling(word).join(', '));
        u.lang = (state.voice && state.voice.lang) || 'en-US';
        u.voice = state.voice || null; u.rate = 0.78; u.pitch = 1.05;
        window.speechSynthesis.speak(u);
      }catch(e){}
    }

    function warn(msg){ document.getElementById('infoText').textContent = msg; }

    // ============================
    // 4) AÇÕES
    // ============================
    function go(delta){
      const { list } = getListForState();
      const next = Math.max(0, Math.min(list.length-1, state.index + delta));
      if(next!==state.index){
        state.index = next; state.revealed = false; updateUI();
        speak(currentWord());
      }
    }

    function chooseGrade(g){ state.grade = g; state.index = 0; state.revealed = false; savePrefs(); updateUI(); }
    function chooseMode(m){ state.mode = m; state.index = 0; state.revealed = false; savePrefs(); updateUI(); }

    // ============================
    // 5) EVENTOS
    // ============================
    // Desbloqueia TTS no primeiro gesto do usuário
    ['click','touchend'].forEach(ev=>{
      document.addEventListener(ev, unlockTTS, { once:true, passive:true });
    });

    els.gradeSelect.addEventListener('change', e=> chooseGrade(e.target.value));
    els.btnEasy.addEventListener('click', ()=>chooseMode('easy'));
    els.btnMedium.addEventListener('click', ()=>chooseMode('medium'));
    els.btnHard.addEventListener('click', ()=>chooseMode('hard'));
    els.btnAuto.addEventListener('click', ()=>chooseMode('auto'));

    document.getElementById('nextBtn').addEventListener('click', ()=>{ go(+1); });
    document.getElementById('prevBtn').addEventListener('click', ()=>{ go(-1); });

    document.getElementById('hearBtn').addEventListener('click', ()=> speak(currentWord()));
    document.getElementById('revealBtn').addEventListener('click', ()=>{ state.revealed = true; updateUI(); });
    document.getElementById('spellBtn').addEventListener('click', ()=> spellOut(currentWord()));

    // Primeira carga
    (function init(){
      loadVoices();              // tenta carregar inicial
      els.gradeSelect.value = state.grade; 
      updateUI();
      warn('Dica: toque em “Próxima palavra” — a palavra será falada e ficará oculta até você revelar.');
    })();
  </script>
</body>
</html>
